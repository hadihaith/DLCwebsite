<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR API Comparison Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        .api-test { margin: 20px 0; padding: 20px; border: 2px solid #dee2e6; border-radius: 8px; }
        .api-test.working { border-color: #28a745; background-color: #d4edda; }
        .api-test.broken { border-color: #dc3545; background-color: #f8d7da; }
        .qr-image { margin: 15px 0; }
        .status { font-weight: bold; font-size: 18px; margin-bottom: 10px; }
        .status.success { color: #28a745; }
        .status.error { color: #dc3545; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ QR API Migration Test</h1>
        <p class="lead">Comparing the old (deprecated) API with the new working API</p>

        <!-- Old API Test -->
        <div class="api-test broken">
            <div class="status error">‚ùå OLD API (Google Charts - Deprecated)</div>
            <p><strong>URL:</strong> <code>https://chart.googleapis.com/chart</code></p>
            <div class="qr-image">
                <img src="https://chart.googleapis.com/chart?cht=qr&chs=300x300&chl=http%3A%2F%2Flocalhost%3A8000%2Fevents%2Fverify%2Fstart%2F123456%2F789012%2F345678%2F" 
                     alt="Google Charts QR (may not work)"
                     onerror="this.nextElementSibling.style.display='block'; this.style.display='none';"
                     style="max-width: 300px;">
                <div style="display:none; padding:20px; background:#fff3cd; border:1px solid #ffc107; border-radius:4px;">
                    ‚ö†Ô∏è <strong>Image failed to load</strong><br>
                    This is expected - the Google Charts QR API was deprecated in 2012 and shut down in 2015.
                </div>
            </div>
            <p class="text-muted"><small>This API may return errors, broken images, or work sporadically.</small></p>
        </div>

        <!-- New API Test -->
        <div class="api-test working">
            <div class="status success">‚úÖ NEW API (QR Server API - Working)</div>
            <p><strong>URL:</strong> <code>https://api.qrserver.com</code></p>
            <div class="qr-image">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=http%3A%2F%2Flocalhost%3A8000%2Fevents%2Fverify%2Fstart%2F123456%2F789012%2F345678%2F" 
                     alt="QR Server API QR (working)"
                     onload="this.nextElementSibling.style.display='block';"
                     onerror="this.nextElementSibling.nextElementSibling.style.display='block';"
                     style="max-width: 300px;">
                <div style="display:none; padding:20px; background:#d4edda; border:1px solid #28a745; border-radius:4px;">
                    ‚úÖ <strong>Image loaded successfully!</strong><br>
                    The QR Server API is working perfectly.
                </div>
                <div style="display:none; padding:20px; background:#f8d7da; border:1px solid #dc3545; border-radius:4px;">
                    ‚ùå <strong>Unexpected error</strong><br>
                    The QR Server API failed to load. Check your internet connection.
                </div>
            </div>
            <p class="text-muted"><small>This API is actively maintained, free, and reliable.</small></p>
        </div>

        <!-- Test Details -->
        <div class="mt-4 p-3" style="background:#e7f3ff; border-radius:8px;">
            <h5>üß™ Test Details</h5>
            <ul>
                <li><strong>Test URL:</strong> http://localhost:8000/events/verify/start/123456/789012/345678/</li>
                <li><strong>QR Size:</strong> 300x300 pixels</li>
                <li><strong>Encoding:</strong> URL-encoded (safe='')</li>
            </ul>
            <p class="mb-0"><strong>Expected Result:</strong> The new API QR code should load successfully, while the old one may fail or show an error.</p>
        </div>

        <!-- Instructions -->
        <div class="mt-4 p-3" style="background:#fff3cd; border-radius:8px;">
            <h5>üì± Test with Your Phone</h5>
            <p>If the new QR code loaded successfully:</p>
            <ol>
                <li>Open your phone's camera app</li>
                <li>Point it at the green QR code above</li>
                <li>It should recognize the URL (though it won't work since localhost isn't accessible from your phone)</li>
            </ol>
            <p class="mb-0"><small>üí° <strong>Tip:</strong> In production, replace "localhost:8000" with your actual domain!</small></p>
        </div>
    </div>

    <script>
        // Log any image load errors to console
        document.addEventListener('DOMContentLoaded', function() {
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.addEventListener('error', function() {
                    console.error('Failed to load:', this.src);
                });
                img.addEventListener('load', function() {
                    console.log('Successfully loaded:', this.src);
                });
            });
        });
    </script>
</body>
</html>

{% extends 'frontend/portal.html' %}
{% load static %}

{% block portal_content %}

<div class="restore-container">
    <div class="warning-banner">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <div class="warning-content">
            <h2>Database Restore - Critical Operation</h2>
            <p><strong>WARNING:</strong> This will completely replace your current database with the uploaded file!</p>
        </div>
    </div>

    <div class="info-box">
        <h3>‚ö° Important Information</h3>
        <ul>
            <li><strong>Automatic Backup:</strong> Your current database will be automatically backed up before restoration</li>
            <li><strong>Complete Replacement:</strong> All current data will be replaced with the uploaded database</li>
            <li><strong>Re-login Required:</strong> You will need to log in again after restoration</li>
            <li><strong>User Credentials:</strong> Use credentials from the restored database</li>
            <li><strong>Backup Location:</strong> Auto-backups are saved in <code>database_backups/</code> folder</li>
        </ul>
    </div>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    <div class="form-container">
        <h3>Upload Database File</h3>
        <form method="post" enctype="multipart/form-data" id="restoreForm">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="database_file">Select Database Backup File</label>
                <input 
                    type="file" 
                    id="database_file" 
                    name="database_file" 
                    accept=".sqlite3,.db,.sqlite,.backup,.sql,.dump"
                    required
                >
                <small class="form-help">
                    Supported formats:<br>
                    ‚Ä¢ SQLite: .sqlite3, .db, .sqlite<br>
                    ‚Ä¢ PostgreSQL: .backup, .sql, .dump
                </small>
            </div>

            <div class="confirmation-box">
                <input type="checkbox" id="confirmRestore" required>
                <label for="confirmRestore">
                    I understand that this will replace the entire current database and I have a backup of my current data
                </label>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-danger" id="restoreBtn" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Restore Database
                </button>
                
                <a href="{% url 'portal' %}" class="btn-cancel">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z"/>
                    </svg>
                    Cancel
                </a>
            </div>
        </form>
    </div>

    <div class="help-box">
        <h3>üìã How to Use</h3>
        <ol>
            <li><strong>Download Backup First:</strong> Always download a backup before restoring</li>
            <li><strong>Select File:</strong> Choose your database backup file (SQLite or PostgreSQL format)</li>
            <li><strong>Confirm:</strong> Check the confirmation box</li>
            <li><strong>Restore:</strong> Click "Restore Database"</li>
            <li><strong>Log In:</strong> Use credentials from the restored database</li>
        </ol>
        <div style="margin-top: 15px; padding: 10px; background: #e8f4f8; border-left: 4px solid #3498db; border-radius: 4px;">
            <strong>Note:</strong> The system automatically detects your database type (SQLite/PostgreSQL) and uses the appropriate restore method.
        </div>
    </div>
</div>

<style>
.restore-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.warning-banner {
    background: linear-gradient(135deg, #c0392b, #e74c3c);
    border: 3px solid #a93226;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    gap: 20px;
    box-shadow: 0 6px 20px rgba(192, 57, 43, 0.3);
}

.warning-icon {
    font-size: 48px;
    flex-shrink: 0;
}

.warning-content h2 {
    color: white;
    margin: 0 0 10px 0;
    font-weight: 700;
}

.warning-content p {
    color: #fef5e7;
    margin: 0;
    font-size: 16px;
}

.info-box, .help-box {
    background: white;
    border: 2px solid #3498db;
    border-radius: 12px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.1);
}

.info-box h3, .help-box h3 {
    color: #2c3e50;
    margin: 0 0 15px 0;
    font-weight: 600;
}

.info-box ul {
    margin: 0;
    padding-left: 25px;
}

.info-box li {
    margin-bottom: 10px;
    color: #34495e;
    line-height: 1.6;
}

.info-box code {
    background-color: #ecf0f1;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 13px;
    color: #e74c3c;
}

.help-box ol {
    margin: 0;
    padding-left: 25px;
}

.help-box li {
    margin-bottom: 10px;
    color: #34495e;
    line-height: 1.6;
}

.alert {
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.alert-success {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
    border: 2px solid #28a745;
    color: #155724;
}

.alert-error {
    background: linear-gradient(135deg, #f8d7da, #f5c6cb);
    border: 2px solid #dc3545;
    color: #721c24;
}

.alert-info {
    background: linear-gradient(135deg, #d1ecf1, #bee5eb);
    border: 2px solid #17a2b8;
    color: #0c5460;
}

.form-container {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid #e9ecef;
    margin-bottom: 30px;
}

.form-container h3 {
    color: #2c3e50;
    margin: 0 0 20px 0;
    font-weight: 600;
}

.form-group {
    margin-bottom: 25px;
}

.form-group label {
    display: block;
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 8px;
    font-size: 14px;
}

.form-group input[type="file"] {
    width: 100%;
    padding: 12px;
    border: 2px solid #e9ecef;
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.2s;
    background-color: white;
}

.form-group input[type="file"]:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.form-help {
    display: block;
    margin-top: 5px;
    font-size: 12px;
    color: #6c757d;
    font-style: italic;
}

.confirmation-box {
    background: linear-gradient(135deg, #fff3cd, #ffeeba);
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.confirmation-box input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
}

.confirmation-box label {
    margin: 0;
    color: #856404;
    font-weight: 500;
    cursor: pointer;
}

.form-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    padding-top: 20px;
    border-top: 1px solid #e9ecef;
}

.btn-danger, .btn-cancel {
    padding: 12px 24px;
    border-radius: 6px;
    border: none;
    font-weight: 500;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
}

.btn-danger {
    background: linear-gradient(135deg, #c0392b, #e74c3c);
    color: white;
}

.btn-danger:hover:not(:disabled) {
    background: linear-gradient(135deg, #a93226, #c0392b);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(192, 57, 43, 0.3);
}

.btn-danger:disabled {
    background: linear-gradient(135deg, #bdc3c7, #d5dbdb);
    color: #7f8c8d;
    cursor: not-allowed;
}

.btn-cancel {
    background: linear-gradient(135deg, #95a5a6, #bdc3c7);
    color: white;
}

.btn-cancel:hover {
    background: linear-gradient(135deg, #7f8c8d, #95a5a6);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(149, 165, 166, 0.3);
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const checkbox = document.getElementById('confirmRestore');
    const restoreBtn = document.getElementById('restoreBtn');
    const form = document.getElementById('restoreForm');
    
    checkbox.addEventListener('change', function() {
        restoreBtn.disabled = !this.checked;
    });
    
    form.addEventListener('submit', function(e) {
        if (!confirm('Are you ABSOLUTELY SURE you want to restore the database? This cannot be undone!')) {
            e.preventDefault();
        }
    });
});
</script>

{% endblock %}

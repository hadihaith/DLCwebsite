{% extends 'frontend/portal.html' %}
{% load static %}

{% block portal_content %}
{% csrf_token %}

<div class="add-member-container">
    <div class="member-header">
        <h2>Add New Member</h2>
        <p>Create a new member account for the Dean's List Council</p>
    </div>

    {% if not can_add_member %}
    <div class="permission-warning">
        <div class="warning-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#e74c3c">
                <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                <path d="M11 11h2v6h-2zm0-4h2v2h-2z"/>
            </svg>
        </div>
        <div class="warning-content">
            <h3>Access Restricted</h3>
            <p>Only <strong>President</strong>, <strong>Vice President</strong>, or <strong>Manager</strong> can add new members.</p>
            <p>You can view the form below but cannot submit it.</p>
        </div>
    </div>
    {% endif %}

    {% if message %}
    <div class="success-message">
        <div class="success-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#27ae60">
                <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                <path d="M10.293 13.293l-2-2L7.586 12l2.707 2.707L16.707 8.293 16 7.586z"/>
            </svg>
        </div>
        <p>{{ message }}</p>
    </div>
    {% endif %}

    {% if error_message %}
    <div class="error-message">
        <div class="error-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="#e74c3c">
                <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                <path d="M15.707 8.707L12 12.414 8.293 8.707 7.586 9.414 11.293 13.121 7.586 16.828 8.293 17.535 12 13.828 15.707 17.535 16.414 16.828 12.707 13.121 16.414 9.414z"/>
            </svg>
        </div>
        <p>{{ error_message }}</p>
    </div>
    {% endif %}

    <div class="form-container">
        <!-- Bulk Creation Section -->
        <div class="bulk-section">
            <div class="section-header">
                <h3>Bulk Member Creation</h3>
                <p>Create multiple active members at once using the format: <code>username,password,First_name Last_name</code></p>
            </div>
            
            <form method="post" class="bulk-form">
                {% csrf_token %}
                <div class="form-group">
                    <label for="bulk_data">Member Data (one per line)</label>
                    <textarea 
                        id="bulk_data" 
                        name="bulk_data" 
                        rows="10"
                        placeholder="john.doe,password123,John Doe"
                        {% if not can_add_member %}disabled{% endif %}
                    ></textarea>
                    <small class="form-help">
                        <strong>Format:</strong> username,password,First_name Last_name (one member per line)<br>
                        <strong>Example:</strong> john.doe,password123,John Doe<br>
                        All created users will be active members with MEMBER role.
                    </small>
                </div>
                
                <div class="form-actions">
                    {% if can_add_member %}
                    <button type="submit" class="btn-submit">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M17 11a1 1 0 0 1 0 2h-4v4a1 1 0 0 1-2 0v-4H7a1 1 0 0 1 0-2h4V7a1 1 0 0 1 2 0v4h4z"/>
                        </svg>
                        Create Members in Bulk
                    </button>
                    {% else %}
                    <button type="button" class="btn-disabled" disabled>
                        Access Restricted
                    </button>
                    {% endif %}
                </div>
            </form>
            
            {% if bulk_results %}
            <div class="bulk-results">
                {% if bulk_results.successes %}
                <div class="results-success">
                    <h4>✓ Successfully Created ({{ bulk_results.success_count }})</h4>
                    <ul>
                        {% for success in bulk_results.successes %}
                        <li>Line {{ success.line }}: <strong>{{ success.name }}</strong> ({{ success.username }})</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                
                {% if bulk_results.errors %}
                <div class="results-errors">
                    <h4>✗ Failed ({{ bulk_results.error_count }})</h4>
                    <ul>
                        {% for error in bulk_results.errors %}
                        <li>
                            <strong>Line {{ error.line }}:</strong> {{ error.data }}<br>
                            <span class="error-detail">{{ error.error }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% endif %}
        </div>
        
        <div class="divider">
            <span>OR</span>
        </div>
        
        <!-- Single Member Creation Section -->
        <div class="section-header">
            <h3>Single Member Creation</h3>
            <p>Add one member with custom settings</p>
        </div>
        
        <form method="post" class="add-member-form">
            {% csrf_token %}
            
            <div class="form-row">
                <div class="form-group">
                    <label for="username">Username <span class="required">*</span></label>
                    <input 
                        type="text" 
                        id="username" 
                        name="username" 
                        placeholder="Enter username"
                        {% if not can_add_member %}disabled{% endif %}
                        required
                    >
                    <small class="form-help">This will be used to log into the portal</small>
                </div>

                <div class="form-group">
                    <label for="password">Password <span class="required">*</span></label>
                    <input 
                        type="password" 
                        id="password" 
                        name="password" 
                        placeholder="Enter password"
                        {% if not can_add_member %}disabled{% endif %}
                        required
                        minlength="6"
                    >
                    <small class="form-help">Minimum 6 characters</small>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="first_name">First Name <span class="required">*</span></label>
                    <input 
                        type="text" 
                        id="first_name" 
                        name="first_name" 
                        placeholder="Enter first name"
                        {% if not can_add_member %}disabled{% endif %}
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="last_name">Last Name <span class="required">*</span></label>
                    <input 
                        type="text" 
                        id="last_name" 
                        name="last_name" 
                        placeholder="Enter last name"
                        {% if not can_add_member %}disabled{% endif %}
                        required
                    >
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="role">Role</label>
                    <select 
                        id="role" 
                        name="role"
                        {% if not can_add_member %}disabled{% endif %}
                    >
                        {% for value, display in role_choices %}
                        <option value="{{ value }}" {% if value == 'MEMBER' %}selected{% endif %}>{{ display }}</option>
                        {% endfor %}
                    </select>
                    <small class="form-help">Select the member's role in the council</small>
                </div>

                <div class="form-group">
                    <label for="is_member">Member Status</label>
                    <div class="checkbox-group">
                        <input 
                            type="checkbox" 
                            id="is_member" 
                            name="is_member"
                            {% if not can_add_member %}disabled{% endif %}
                            checked
                        >
                        <label for="is_member" class="checkbox-label">Active Council Member</label>
                    </div>
                    <small class="form-help">Check if this person should appear in the members page</small>
                </div>
            </div>



            <div class="form-actions">
                {% if can_add_member %}
                <button type="submit" class="btn-submit">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                        <path d="M13 7h-2v4H7v2h4v4h2v-4h4v-2h-4V7z"/>
                    </svg>
                    Add Member
                </button>
                {% else %}
                <button type="button" class="btn-disabled" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/>
                        <path d="M15.536 8.464L9 15l-4.536-4.536L6.05 8.879 9 11.829l5.172-5.172z"/>
                    </svg>
                    Access Restricted
                </button>
                {% endif %}
                
                <a href="{% url 'portal' %}" class="btn-cancel">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 11H7.83l4.88-4.88c.39-.39.39-1.03 0-1.42-.39-.39-1.02-.39-1.41 0l-6.59 6.59c-.39.39-.39 1.02 0 1.41l6.59 6.59c.39.39 1.02.39 1.41 0 .39-.39.39-1.02 0-1.41L7.83 13H19c.55 0 1-.45 1-1s-.45-1-1-1z"/>
                    </svg>
                    Back to Portal
                </a>
            </div>
        </form>
    </div>
</div>

<style>
.add-member-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 20px;
}

.member-header {
    text-align: center;
    margin-bottom: 30px;
}

.member-header h2 {
    color: #2c3e50;
    margin-bottom: 10px;
    font-weight: 600;
}

.member-header p {
    color: #7f8c8d;
    font-size: 16px;
}

.bulk-section {
    margin-bottom: 30px;
    padding: 25px;
    background: linear-gradient(135deg, #f0f9ff, #e0f2fe);
    border: 2px solid #3498db;
    border-radius: 12px;
}

.section-header {
    margin-bottom: 20px;
}

.section-header h3 {
    color: #2c3e50;
    margin-bottom: 8px;
    font-weight: 600;
}

.section-header p {
    color: #546e7a;
    font-size: 14px;
    margin: 0;
}

.section-header code {
    background-color: #263238;
    color: #4fc3f7;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 13px;
}

.bulk-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.bulk-form textarea {
    padding: 12px;
    border: 2px solid #90caf9;
    border-radius: 6px;
    font-size: 14px;
    font-family: 'Courier New', monospace;
    transition: all 0.2s;
    background-color: white;
    resize: vertical;
}

.bulk-form textarea:focus {
    outline: none;
    border-color: #2196f3;
    box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
}

.bulk-form textarea:disabled {
    background-color: #f8f9fa;
    color: #6c757d;
    cursor: not-allowed;
}

.bulk-results {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.results-success, .results-errors {
    padding: 15px;
    border-radius: 8px;
}

.results-success {
    background: linear-gradient(135deg, #d4edda, #c3e6cb);
    border: 2px solid #28a745;
}

.results-success h4 {
    color: #155724;
    margin: 0 0 10px 0;
    font-size: 16px;
}

.results-success ul {
    margin: 0;
    padding-left: 20px;
}

.results-success li {
    color: #155724;
    margin-bottom: 5px;
}

.results-errors {
    background: linear-gradient(135deg, #f8d7da, #f5c6cb);
    border: 2px solid #dc3545;
}

.results-errors h4 {
    color: #721c24;
    margin: 0 0 10px 0;
    font-size: 16px;
}

.results-errors ul {
    margin: 0;
    padding-left: 20px;
}

.results-errors li {
    color: #721c24;
    margin-bottom: 10px;
}

.error-detail {
    display: block;
    font-size: 13px;
    color: #c82333;
    margin-top: 3px;
    font-style: italic;
}

.divider {
    position: relative;
    text-align: center;
    margin: 30px 0;
}

.divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(to right, transparent, #dee2e6, transparent);
}

.divider span {
    position: relative;
    background: white;
    padding: 0 15px;
    color: #6c757d;
    font-weight: 600;
    font-size: 14px;
}

.permission-warning {
    background: linear-gradient(135deg, #fee, #fdd);
    border: 1px solid #e74c3c;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
    display: flex;
    align-items: flex-start;
    gap: 15px;
}

.warning-icon, .success-icon, .error-icon, .info-icon {
    flex-shrink: 0;
}

.warning-content h3 {
    margin: 0 0 10px 0;
    color: #e74c3c;
    font-weight: 600;
}

.warning-content p {
    margin: 5px 0;
    color: #c0392b;
}

.success-message, .error-message {
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.success-message {
    background: linear-gradient(135deg, #dff0d8, #c3e6cb);
    border: 1px solid #27ae60;
}

.error-message {
    background: linear-gradient(135deg, #fee, #fdd);
    border: 1px solid #e74c3c;
}

.success-message p, .error-message p {
    margin: 0;
    font-weight: 500;
}

.success-message p {
    color: #27ae60;
}

.error-message p {
    color: #e74c3c;
}

.form-container {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid #e9ecef;
}

.add-member-form {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.form-group label {
    font-weight: 600;
    color: #2c3e50;
    font-size: 14px;
}

.required {
    color: #e74c3c;
}

.form-group input, .form-group select {
    padding: 12px;
    border: 2px solid #e9ecef;
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.2s;
    background-color: white;
}

.form-group input:focus, .form-group select:focus {
    outline: none;
    border-color: #3498db;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.form-group input:disabled, .form-group select:disabled {
    background-color: #f8f9fa;
    color: #6c757d;
    cursor: not-allowed;
}

.form-help {
    font-size: 12px;
    color: #6c757d;
    font-style: italic;
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 8px;
}

.checkbox-group input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.checkbox-label {
    margin: 0 !important;
    font-weight: 500 !important;
    color: #495057 !important;
    cursor: pointer;
}

.checkbox-group input[type="checkbox"]:disabled + .checkbox-label {
    color: #6c757d !important;
    cursor: not-allowed;
}

.email-info {
    background: linear-gradient(135deg, #e3f2fd, #bbdefb);
    border: 1px solid #3498db;
    border-radius: 8px;
    padding: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.email-info p {
    margin: 0;
    color: #2980b9;
    font-size: 14px;
}

.email-info code {
    background-color: #2980b9;
    color: white;
    padding: 2px 6px;
    border-radius: 4px;
    font-size: 13px;
}

.form-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
    padding-top: 20px;
    border-top: 1px solid #e9ecef;
}

.btn-submit, .btn-cancel, .btn-disabled {
    padding: 12px 24px;
    border-radius: 6px;
    border: none;
    font-weight: 500;
    text-decoration: none;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
}

.btn-submit {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
    color: white;
}

.btn-submit:hover {
    background: linear-gradient(135deg, #229954, #27ae60);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
}

.btn-cancel {
    background: linear-gradient(135deg, #95a5a6, #bdc3c7);
    color: white;
}

.btn-cancel:hover {
    background: linear-gradient(135deg, #7f8c8d, #95a5a6);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(149, 165, 166, 0.3);
}

.btn-disabled {
    background: linear-gradient(135deg, #bdc3c7, #d5dbdb);
    color: #7f8c8d;
    cursor: not-allowed;
}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
    
    .form-actions {
        flex-direction: column;
    }
}
</style>

{% endblock %}

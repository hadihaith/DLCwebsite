{% extends 'frontend/layout.html' %}


{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'frontend/assets/css/portal.css' %}">
<div class="dashboard">
	<aside class="search-wrap">
		<div class="search">
			<label for="search">
				<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 18a7.952 7.952 0 0 0 4.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0 0 18 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z"/></svg>
				<input type="text" id="search">
			</label>
		</div>
		
		<div class="user-actions">
			<button>
				<a href="{% url 'logout' %}">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 21c4.411 0 8-3.589 8-8 0-3.35-2.072-6.221-5-7.411v2.223A6 6 0 0 1 18 13c0 3.309-2.691 6-6 6s-6-2.691-6-6a5.999 5.999 0 0 1 3-5.188V5.589C6.072 6.779 4 9.65 4 13c0 4.411 3.589 8 8 8z"/><path d="M11 2h2v10h-2z"/></svg>
				</a>
			</button>
		</div>
	</aside>
	
	<header class="menu-wrap">
		<figure class="user">
			<div class="user-avatar">
				<img src="{% static 'img/white_dlc.png' %}" style="background-color: black;" alt="{{ user.first_name }} {{ user.last_name }}">
			</div>
			<figcaption>
					{{ user.first_name }} {{ user.last_name }}
			</figcaption>
		</figure>
	
		<nav>
			
		
			<section class="tools">
				<h3>Tools</h3>
				
				<ul>
					<li>
						<a href="{% url 'student_search' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M10 18a7.952 7.952 0 0 0 4.897-1.688l4.396 4.396 1.414-1.414-4.396-4.396A7.952 7.952 0 0 0 18 10c0-4.411-3.589-8-8-8s-8 3.589-8 8 3.589 8 8 8zm0-14c3.309 0 6 2.691 6 6s-2.691 6-6 6-6-2.691-6-6 2.691-6 6-6z"/></svg>
							Search for a student
						</a>
					</li>
					
					<li>
						<a href="{% url 'application_management' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm0 16H5V5h14v14z"/><path d="M17 8.5H7a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zm0 2H7a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zm0 2H7a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zm0 2H7a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1z"/></svg>
							Manage Applications
						</a>
					</li>
					
					<li>
						<a href="{% url 'parking_management' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13.5,7h-3C9.7,7,9,7.7,9,8.5v7C9,16.3,9.7,17,10.5,17h3c0.8,0,1.5-0.7,1.5-1.5v-7C15,7.7,14.3,7,13.5,7z"/><path d="M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M12,20c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8 S16.4,20,12,20z"/><path d="M11.5,8h-1C10.2,8,10,8.2,10,8.5v7c0,0.3,0.2,0.5,0.5,0.5h1c1.4,0,2.5-1.1,2.5-2.5v-1C14,11.1,12.9,10,11.5,10z M13,13.5 c0,0.8-0.7,1.5-1.5,1.5H11v-4h1.5c0.8,0,1.5,0.7,1.5,1.5V13.5z"/></svg>
							Manage Parking
						</a>
					</li>
					
					<li>
						<a href="{% url 'add_member' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M13 7L11 7 11 11 7 11 7 13 11 13 11 17 13 17 13 13 17 13 17 11 13 11z"/><path d="M12,2C6.486,2,2,6.486,2,12s4.486,10,10,10c5.514,0,10-4.486,10-10S17.514,2,12,2z M12,20c-4.411,0-8-3.589-8-8 s3.589-8,8-8s8,3.589,8,8S16.411,20,12,20z"/></svg>
							Add a member
						</a>
					</li>
					
					<li>
						<a href="{% url 'manage_members' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M3,21c0,0.553,0.448,1,1,1h16c0.553,0,1-0.447,1-1v-1c0-3.714-2.261-6.907-5.478-8.281C16.729,10.709,17.5,9.193,17.5,7.5 C17.5,4.468,15.032,2,12,2C8.967,2,6.5,4.468,6.5,7.5c0,1.693,0.771,3.209,1.978,4.219C5.261,13.093,3,16.287,3,20V21z M8.5,7.5 C8.5,5.57,10.07,4,12,4s3.5,1.57,3.5,3.5S13.93,11,12,11S8.5,9.43,8.5,7.5z M12,13c3.859,0,7,3.141,7,7H5C5,16.141,8.14,13,12,13z"/><path d="M19.5,8.5h-1v-1c0-0.276-0.224-0.5-0.5-0.5s-0.5,0.224-0.5,0.5v1h-1c-0.276,0-0.5,0.224-0.5,0.5s0.224,0.5,0.5,0.5h1v1 c0,0.276,0.224,0.5,0.5,0.5s0.5-0.224,0.5-0.5v-1h1c0.276,0,0.5-0.224,0.5-0.5S19.776,8.5,19.5,8.5z"/></svg>
							Manage members
						</a>
					</li>
					
					<li>
						<a href="{% url 'thread_settings' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 16c2.206 0 4-1.794 4-4s-1.794-4-4-4-4 1.794-4 4 1.794 4 4 4zm0-6c1.084 0 2 .916 2 2s-.916 2-2 2-2-.916-2-2 .916-2 2-2z"/><path d="m2.845 16.136 1 1.73c.531.917 1.809 1.261 2.73.73l.529-.306A8.1 8.1 0 0 0 9 19.402V20c0 1.103.897 2 2 2h2c1.103 0 2-.897 2-2v-.598a8.132 8.132 0 0 0 1.896-1.111l.529.306c.923.53 2.198.188 2.731-.731l.999-1.729a2.001 2.001 0 0 0-.731-2.732l-.505-.292a7.718 7.718 0 0 0 0-2.224l.505-.292a2.002 2.002 0 0 0 .731-2.732l-.999-1.729c-.531-.92-1.808-1.265-2.731-.732l-.529.306A8.1 8.1 0 0 0 15 4.598V4c0-1.103-.897-2-2-2h-2c-1.103 0-2 .897-2 2v.598a8.132 8.132 0 0 0-1.896 1.111l-.529-.306c-.924-.531-2.2-.187-2.731.732l-.999 1.729a2.001 2.001 0 0 0 .731 2.732l.505.292a7.683 7.683 0 0 0 0 2.223l-.505.292a2.003 2.003 0 0 0-.731 2.733zm3.326-2.758A5.703 5.703 0 0 1 6 12c0-.462.058-.926.17-1.378a.999.999 0 0 0-.47-1.108l-1.123-.65.998-1.729 1.145.662a.997.997 0 0 0 1.188-.142 6.071 6.071 0 0 1 2.384-1.399A1 1 0 0 0 11 5.3V4h2v1.3a1 1 0 0 0 .708.956 6.083 6.083 0 0 1 2.384 1.399.999.999 0 0 0 1.188.142l1.144-.661 1 1.729-1.124.649a1 1 0 0 0-.47 1.108c.112.452.17.916.17 1.378s-.058.926-.17 1.378a.999.999 0 0 0 .47 1.108l1.123.649-.998 1.729-1.145-.661a.996.996 0 0 0-1.188.142 6.071 6.071 0 0 1-2.384 1.399A1 1 0 0 0 13 18.7V20h-2v-1.3a1 1 0 0 0-.708-.956 6.083 6.083 0 0 1-2.384-1.399.992.992 0 0 0-1.188-.142l-1.144.662-1-1.729 1.124-.651a1 1 0 0 0 .47-1.108z"/></svg>
							Thread Settings
						</a>
					</li>
					
					<li>
						<a href="{% url 'exchange_program_settings' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/><path d="M11 11h2v6h-2zm0-4h2v2h-2z"/></svg>
							Exchange Program Settings
						</a>
					</li>

					{% if user.is_superuser or user.is_exchange_officer %}
					<li>
						<a href="{% url 'exchange_dashboard' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M21 16v-2l-8-5V4.5a2.5 2.5 0 0 0-5 0V9L0 14v2l8-2.5V17l-2 1.5V20l3-1 3 1v-1.5L10 17v-3.5l11 2.5z"/></svg>
							Exchange Program Dashboard
						</a>
					</li>
					<li>
						<a href="{% url 'exchange_application_management' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm0 16H5V5h14v14z"/><path d="M7 7h10v2H7zm0 4h10v2H7zm0 4h6v2H7z"/></svg>
							Manage Exchange Applications
						</a>
					</li>
					{% endif %}
					
					<li>
						<a href="{% url 'events_dashboard' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 4h-2V2h-2v2H9V2H7v2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V6c0-1.103-.897-2-2-2zm.002 16H5V8h14l.002 12z"/><path d="M11 17h2v-2h-2v2zm0-4h2v-2h-2v2zm4 4h2v-2h-2v2zm0-4h2v-2h-2v2zm-8 4h2v-2H7v2zm0-4h2v-2H7v2z"/></svg>
							Events Dashboard
						</a>
					</li>
					
					<li>
						<a href="{% url 'refresh_courses' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10c5.514 0 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/><path d="M13 7h-2v5.414l3.293 3.293 1.414-1.414L13 11.586z"/></svg>
							Refresh Courses
						</a>
					</li>
					
					<li>
						<a href="{% url 'newdl' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M21 4H3a1 1 0 0 0-1 1v14a1 1 0 0 0 1 1h18a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1zm-1 14H4V9.227l7.335 6.521a1.003 1.003 0 0 0 1.33-.001L20 9.227V18zm0-11.448l-8 7.11-8-7.111V6h16v.552z"/></svg>
							Create a New Dean's list
						</a>
					</li>
					
					<li>
						<a href="{% url 'merged_deans_list' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M3 3h8v8H3V3zm10 0h8v8h-8V3zM3 13h8v8H3v-8zm15 0h-2v3h-3v2h3v3h2v-3h3v-2h-3v-3z"/></svg>
							Merged Dean's List View
						</a>
					</li>
				</ul>
			</section>
			
			{% if user.is_superuser or user.is_staff %}
			<section class="tools">
				<h3>Database</h3>
				<ul>
					<li>
						<a href="{% url 'backup_database' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M18.948 11.112C18.511 7.67 15.563 5 12.004 5c-2.756 0-5.15 1.611-6.243 4.15-2.148.642-3.757 2.67-3.757 4.85 0 2.757 2.243 5 5 5h1v-2h-1c-1.654 0-3-1.346-3-3 0-1.404 1.199-2.756 2.673-3.015l.581-.102.192-.558C8.153 8.273 9.898 7 12.004 7c2.757 0 5 2.243 5 5v1h1.5c1.378 0 2.5 1.122 2.5 2.5S19.882 18 18.504 18H17v2h1.504c2.481 0 4.5-2.019 4.5-4.5s-2.019-4.5-4.5-4.5h-.556v-.888zM11 13v-3h2v3h3l-4 5-4-5h3z"/></svg>
							Download Database
						</a>
					</li>
					<li>
						<a href="{% url 'restore_database' %}">
							<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M18.948 11.112C18.511 7.67 15.563 5 12.004 5c-2.756 0-5.15 1.611-6.243 4.15-2.148.642-3.757 2.67-3.757 4.85 0 2.757 2.243 5 5 5h1v-2h-1c-1.654 0-3-1.346-3-3 0-1.404 1.199-2.756 2.673-3.015l.581-.102.192-.558C8.153 8.273 9.898 7 12.004 7c2.757 0 5 2.243 5 5v1h1.5c1.378 0 2.5 1.122 2.5 2.5S19.882 18 18.504 18H17v2h1.504c2.481 0 4.5-2.019 4.5-4.5s-2.019-4.5-4.5-4.5h-.556v-.888zM13 14v3h-2v-3H8l4-5 4 5h-3z"/></svg>
							Restore Database
						</a>
					</li>
				</ul>
			</section>
			{% endif %}
			
			
		</nav>
	</header>
	
	<main class="content-wrap">
		<header class="content-head">
			<h1>DLC Portal</h1>
		
				
			<div class="action">
				<button>
					Save search
				</button>
			</div>
		</header>
		
		<div class="content">
			<section class="info-boxes">
				<div class="info-box">
					<div class="box-icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zm0 16H5V5h14v14z"/><path d="M17 8.5H7a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zm0 2H7a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zm0 2H7a.5.5 0 0 0 0 1h10a.5.5 0 0 0 0-1zm0 2H7a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1z"/></svg>
					</div>
					
					<div class="box-content">
						<span class="big">{{ pending_applications|default:"0" }}</span>
						Pending Applications
					</div>
				</div>
				
				<div class="info-box active">
					<div class="box-icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M3,21c0,0.553,0.448,1,1,1h16c0.553,0,1-0.447,1-1v-1c0-3.714-2.261-6.907-5.478-8.281C16.729,10.709,17.5,9.193,17.5,7.5 C17.5,4.468,15.032,2,12,2C8.967,2,6.5,4.468,6.5,7.5c0,1.693,0.771,3.209,1.978,4.219C5.261,13.093,3,16.287,3,20V21z M8.5,7.5 C8.5,5.57,10.07,4,12,4s3.5,1.57,3.5,3.5S13.93,11,12,11S8.5,9.43,8.5,7.5z M12,13c3.859,0,7,3.141,7,7H5C5,16.141,8.14,13,12,13z"/></svg>
					</div>
					
					<div class="box-content">
						<span class="big">{{ member_count|default:"0" }} <span style="font-size: 0.8em;">Members</span></span>
						Active Members
					</div>
				</div>
				
				<div class="info-box">
					<div class="box-icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M20 10H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V11a1 1 0 0 0-1-1zm-1 10H5v-8h14v8zM5 6h14v2H5zM7 2h10v2H7z"/></svg>
					</div>
					
					<div class="box-content">
						<span class="big">{{ dean_list_count|default:"0" }} <span style="font-size: 0.8em;">Lists</span></span>
						Dean's Lists
					</div>
				</div>
				
				<div class="info-box">
					<div class="box-icon">
						<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 3C6.486 3 2 6.364 2 10.5c0 2.742 1.982 5.354 5 6.678V21a.999.999 0 0 0 1.707.707l3.714-3.714C17.74 17.827 22 14.529 22 10.5 22 6.364 17.514 3 12 3zm0 13a.996.996 0 0 0-.707.293L9 18.586V16.5a1 1 0 0 0-.663-.941C5.743 14.629 4 12.596 4 10.5 4 7.468 7.589 5 12 5s8 2.468 8 5.5-3.589 5.5-8 5.5z"/></svg>
					</div>
					
					<div class="box-content">
						<span class="big">{{ total_dean_list_students|default:"0" }} <span style="font-size: 0.8em;">Students</span></span>
						Latest Dean's List
					</div>
				</div>
			</section>
			<section> 
				{% block portal_content %}
				<div style="margin-bottom:20px;">
					{% if user.is_authenticated %}
						{% if user.is_staff or user.is_member %}
							<a href="{% url 'create_event' %}" class="btn btn-primary">Create an Event</a>
						{% endif %}
					{% endif %}
				</div>

				{% if events %}
					<h3>Your Events</h3>
					<ul class="list-group mb-3">
						{% for ev in events %}
						<li class="list-group-item d-flex justify-content-between align-items-center">
							<div>
								<strong>{{ ev.title }}</strong><br>
								<small class="text-muted">{{ ev.start_date }}{% if ev.end_date and ev.end_date != ev.start_date %} - {{ ev.end_date }}{% endif %}</small>
							</div>
							<div>
								<a class="btn btn-sm btn-outline-secondary" href="{% url 'event_detail' ev.pk %}">View</a>
								{% if user.is_authenticated %}
									{% if user.is_staff or user.is_member %}
									<form method="post" action="{% url 'delete_event' ev.pk %}" style="display:inline-block; margin-left:10px; position:relative;" class="event-delete-form" data-title="{{ ev.title|escape }}">
											{% csrf_token %}
											<button type="button" class="btn btn-sm btn-danger btn-delete-trigger">Delete</button>

											<div class="inline-confirm" style="display:none;">
												<div class="inline-confirm-inner">
													<div class="inline-confirm-title">Delete "<span class="confirm-title"></span>"?</div>
													<div class="inline-confirm-actions">
														<button type="button" class="btn btn-sm btn-secondary btn-cancel">Cancel</button>
														<button type="submit" class="btn btn-sm btn-danger btn-confirm" style="margin-left:6px;">Confirm</button>
													</div>
												</div>
											</div>
										</form>
									{% endif %}
								{% endif %}
							</div>
						</li>
						{% endfor %}
					</ul>
				{% endif %}
				{% endblock %}
			</section>
						<script>
						document.addEventListener('DOMContentLoaded', function() {
							document.querySelectorAll('.event-delete-form').forEach(function(form) {
									var trigger = form.querySelector('.btn-delete-trigger');
									var inline = form.querySelector('.inline-confirm');
									var titleEl = inline ? inline.querySelector('.confirm-title') : null;
									if (titleEl) titleEl.textContent = form.getAttribute('data-title') || 'this event';

									if (trigger && inline) {
										trigger.addEventListener('click', function(e) {
											// create backdrop
											var backdrop = document.createElement('div');
											backdrop.className = 'confirm-backdrop';
											document.body.appendChild(backdrop);

											// create modal container
											var modal = document.createElement('div');
											modal.className = 'confirm-modal';
											modal.innerHTML = inline.querySelector('.inline-confirm-inner').outerHTML;
											document.body.appendChild(modal);

											// set title
											var mt = modal.querySelector('.confirm-title');
											if (mt) mt.textContent = form.getAttribute('data-title') || 'this event';

											// cancel handler
											modal.querySelector('.btn-cancel').addEventListener('click', function() {
												modal.remove();
												backdrop.remove();
											});

											// when confirm (submit) clicked, submit the original form
											modal.querySelector('.btn-confirm').addEventListener('click', function() {
												// append a hidden input to indicate JS-confirmed
												var inp = document.createElement('input');
												inp.type = 'hidden'; inp.name = 'confirmed'; inp.value = '1';
												form.appendChild(inp);
												form.submit();
											});

											// clicking backdrop cancels
											backdrop.addEventListener('click', function() {
												modal.remove();
												backdrop.remove();
											});
										});
									}
								});
						});

	// Modal/backdrop styles (inserted via JS so no template head edits needed)
	var style = document.createElement('style');
	style.textContent = '\n.confirm-backdrop { position:fixed; left:0; top:0; right:0; bottom:0; background:rgba(0,0,0,0.45); z-index:1000; }\n.confirm-modal { position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); background:white; padding:18px; border-radius:8px; box-shadow:0 8px 32px rgba(0,0,0,0.35); z-index:1001; width:90%; max-width:480px; }\n.confirm-modal .inline-confirm-title { font-size:1.05em; margin-bottom:12px; }\n.confirm-modal .inline-confirm-actions { text-align:right; }\n';
	document.head.appendChild(style);
						</script>
	</main>
</div>
{% endblock %}
{% extends 'frontend/layout.html' %}
{% load static %}

{% block title %}Apply for Exchange at KU{% endblock %}

{% block content %}
<section class="py-5" style="background:linear-gradient(135deg,#4a2e5f 0%,#704f9a 100%);">
    <div class="container py-5 text-white">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <span class="badge bg-light text-primary mb-3" style="font-size:0.85rem;">Incoming Student Application</span>
                <h1 class="display-5 fw-bold mb-3">Start your Kuwait University exchange experience</h1>
                <p class="lead mb-0">Complete the form below exactly as it appears on your official documents. Upload clear PDFs for academic records and ensure your passport remains valid for at least one year from the date of submission.</p>
            </div>
            <div class="col-lg-5 text-lg-end mt-4 mt-lg-0">
                <img src="{% static 'frontend/assets/img/exchange-application.png' %}" alt="Exchange application" class="img-fluid" onerror="this.style.display='none';">
            </div>
        </div>
    </div>
</section>

<section class="py-5 bg-light">
    <div class="container">
        {% if submitted %}
        <div class="alert alert-success shadow-sm" role="alert">
            <h2 class="h5 fw-bold">Thank you for submitting your application!</h2>
            <p class="mb-1">Our exchange team will review your documents and contact you via email with the next steps. Please keep copies of all uploaded files for your records.</p>
        </div>
        {% endif %}

        {% if partner_count == 0 %}
        <div class="alert alert-warning" role="alert">
            We could not find any partner universities in our system. Please contact the Dean's List Council before submitting your application.
        </div>
        {% endif %}

        <div class="card shadow-sm border-0">
            <div class="card-body p-4 p-lg-5">
                <form method="post" enctype="multipart/form-data" novalidate>
                    {% csrf_token %}

                    {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {% for error in form.non_field_errors %}
                            <div>{{ error }}</div>
                        {% endfor %}
                    </div>
                    {% endif %}

                    <div class="row g-4">
                        <div class="col-12">
                            <h2 class="h5 text-primary mb-3">Applicant information</h2>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_first_name">{{ form.first_name.label }}</label>
                            {{ form.first_name }}
                            {% for error in form.first_name.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_last_name">{{ form.last_name.label }}</label>
                            {{ form.last_name }}
                            {% for error in form.last_name.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_date_of_birth">{{ form.date_of_birth.label }}</label>
                            {{ form.date_of_birth }}
                            {% for error in form.date_of_birth.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_gender">{{ form.gender.label }}</label>
                            {{ form.gender }}
                            {% for error in form.gender.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_program_level">{{ form.program_level.label }}</label>
                            {{ form.program_level }}
                            {% for error in form.program_level.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_email">{{ form.email.label }}</label>
                            {{ form.email }}
                            {% for error in form.email.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                    </div>

                    <hr class="my-5">

                    <div class="row g-4">
                        <div class="col-12">
                            <h2 class="h5 text-primary mb-3">Home institution details</h2>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_home_institution">{{ form.home_institution.label }}</label>
                            {{ form.home_institution }}
                            <div class="form-text">Select the partner university that is nominating you.</div>
                            {% for error in form.home_institution.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_home_major">{{ form.home_major.label }}</label>
                            {{ form.home_major }}
                            {% for error in form.home_major.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_coordinator_name">{{ form.coordinator_name.label }}</label>
                            {{ form.coordinator_name }}
                            {% for error in form.coordinator_name.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_coordinator_email">{{ form.coordinator_email.label }}</label>
                            {{ form.coordinator_email }}
                            {% for error in form.coordinator_email.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                    </div>

                    <hr class="my-5">

                    <div class="row g-4">
                        <div class="col-12">
                            <h2 class="h5 text-primary mb-3">Exchange term & eligibility</h2>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_exchange_semester">{{ form.exchange_semester.label }}</label>
                            {{ form.exchange_semester }}
                            {% for error in form.exchange_semester.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_exchange_academic_year">{{ form.exchange_academic_year.label }}</label>
                            {{ form.exchange_academic_year }}
                            {% for error in form.exchange_academic_year.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_completed_credits">{{ form.completed_credits.label }}</label>
                            {{ form.completed_credits }}
                            {% for error in form.completed_credits.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                    </div>

                    <hr class="my-5">

                    <div class="row g-4">
                        <div class="col-12">
                            <h2 class="h5 text-primary mb-3">Passport information</h2>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_passport_number">{{ form.passport_number.label }}</label>
                            {{ form.passport_number }}
                            {% for error in form.passport_number.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="id_passport_expiry_date">{{ form.passport_expiry_date.label }}</label>
                            {{ form.passport_expiry_date }}
                            {% for error in form.passport_expiry_date.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                    </div>

                    <hr class="my-5">

                    <div class="row g-4">
                        <div class="col-12">
                            <h2 class="h5 text-primary mb-3">Required documents</h2>
                            <p class="text-muted small mb-4">Upload clear, legible scans. PDF files are preferred unless otherwise noted.</p>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_english_proficiency_document">{{ form.english_proficiency_document.label }}</label>
                            {{ form.english_proficiency_document }}
                            {% for error in form.english_proficiency_document.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_transcript_document">{{ form.transcript_document.label }}</label>
                            {{ form.transcript_document }}
                            {% for error in form.transcript_document.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-4">
                            <label class="form-label" for="id_passport_copy">{{ form.passport_copy.label }}</label>
                            {{ form.passport_copy }}
                            {% for error in form.passport_copy.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                    </div>

                    <hr class="my-5">

                    <div class="row g-4">
                        <div class="col-12">
                            <h2 class="h5 text-primary mb-3">Declarations</h2>
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                {{ form.accommodation_needed }}
                                <label class="form-check-label" for="id_accommodation_needed">{{ form.accommodation_needed.label }}</label>
                            </div>
                            {% for error in form.accommodation_needed.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                        <div class="col-md-6">
                            <div class="form-check">
                                {{ form.has_criminal_record }}
                                <label class="form-check-label" for="id_has_criminal_record">{{ form.has_criminal_record.label }}</label>
                            </div>
                            {% for error in form.has_criminal_record.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        </div>
                    </div>

                    <div class="mt-5 d-flex justify-content-end">
                        <button type="submit" class="btn btn-primary btn-lg px-4">
                            Submit application
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}
